모던 자바 인 액션 Part 6
------------------------

#### Chap 18 : 함수형 관점으로 생각하기

-	함수형? 람다, 일급 함수와 관련 있으며 때로는 객체 변화를 제한하는 것이 함수형과 밀접한 관련을 갖는다.
-	함수형을 적용하면 어떤 점이 좋은가? 에 대한 답을 찾는다.

##### 18.1 시스템 구현과 유지보수

-	쉽게 유지보수 할 수 있으려면 ???

	-	프로그램이 시스템의 구조를 이해하기 쉽게 클래스 계층으로 반영하면 좋음
	-	시스템의 각 부분의 상호 의존성을 가리키는 결합성과 시스템의 다양한 부분이 어떤 관계를 갖는지 가리키는 응집성이라는 소프트웨어 엔지니어링 도구로 프로그램 구조를 평가할 수 있다.

-	그러나 많은 프로그래머는 유지보수 중 코드 크래시 디버깅 문제를 가장 많이 겪음 (에상하지 못한 변숫 값 등)

	-	함수형 프로그래밍이 제공하는 부작용 없음과 불변성이 라는 개념이 이 문제를 해결하는 데 도움을 준다.

-	공유된 가변 데이터

	-	변수가 예상하지 못한 값을 갖는 이유는 결국 유지보수하는 시스템에서 여러 메서드에서 공유된 가변 데이터 구조를 읽고 갱신하기 떄문임.

	-	공유 가변 데이터 구조를 사용하면 프로그램 전체에서 데이터 갱신 사실을 추적하기가 어려워짐

	-	자신을 포함하는 클래스의 상태 그리고 다른 객체의 상태를 바꾸지 않으며 return 문을 통해서만 자신의 결과를 반환하는 메서드를 순수 메서드 또는 부작용 없는 메서드라고 부른다. (아래는 부작용 예시)

		-	자료구조를 고치거나 필드에 값을 할당(setter 메서드 같은 생성자 이외의 초기화 동작)
		-	예외발생
		-	파일에 쓰기 등의 I/O 동작 수행

	-	부작용 없는 시스템의 개념은 함수형 프로그래밍에서 유래되었다.

-	선언형 프로그래밍

	-	프로그램으로 시스템을 구현하는 방식은 크게 두 가지로 구분할 수 있다.
		-	'어떻게' 수행할 것인지에 집중 (고전적 객체지향프로그래밍에서 이용하는 방식: 할당, 조건문, 분기문, 루프 등- 명령형 프로그래밍)
		-	'무엇을' 집중하는 방법 (질의문 구현 방법은 라이브러리가 결정 -선언형 프로그래밍)

-	왜 함수형 프로그래밍인가?

	-	함수형 프로그래밍은 선언형 프로그래밍을 따르는 대표적인 방식이며, 이전에 설명한 것 처럼 부작용이 없는 계산을 지향한다.
		-	선언형 프로그래밍과 부작용을 멀리한다는 두 가지 개념은 좀 더 쉽게 시스템을 구현하고 유지보수하는 데 도움을 준다.
		-	람다표현식을 이용해서 보여준 것 처럼 작업을 조합하거나 동작을 전달하는 등의 언어 기능은 선언형을 활용해서 자연스럽게 읽고 쓸 수 있는 코드를 구현하는 데 많은 도움을 준다. (스트림은 여러 연산을 연결해서 복잡한 질의를 표현할 수 있었다.)

##### 18.2 함수형 프로그래밍이란 무엇인가?

-	함수를 이용하는 프로그래밍...

-	함수형 프로그래밍에서 함수란 수학적인 함수와 같다.

	-	함수는 0개 이상의 인수를 가지며, 한 개 이상의 결과를 반환하지만 부작용이 없어야한다.
	-	자바와 같은 언어에서는 수학적인 함수냐 아니냐가 메서드와 함수를 구분하는 핵심 (인수가 같다면 반복적 호출 시 항상 같은 결과가 반환되야함)
	-	함수형 : 수학의 함수처럼 부작용이 없는 것
	-	함수형 프로그래밍
		-	함수 그리고 if-then-else 등의 수학적 표현만 사용하는 방식
		-	시스템의 다른 부분에 영향을 미치지 않는다면 내부적으로는 함수형이 아닌 기능도 사용하는 방식

-	함수형 자바

	-	실질적으로 자바로는 완벽한 순수 함수형 프로그래밍을 구현하기 어렵다. 하지만, 시스템의 컴포넌트가 순수한 함수형인 것 처럼 동작하도록 코드를 구현할 수 있다.

		-	자바에서는 순수 함수형이 아니라 함수형 프로그램을 구현
		-	실제 부작용이 있지만 아무도 이를 보지 못하게 함으로써 함수형을 달성할 수 있음

	-	함수형 자바는?

		-	함수나 메서드는 지역변수만을 변경해여 함수형이라 할 수 있다.
		-	함수나 메서드에서 참조하는 객체가 있다면 그 객체는 불변 객체여야 함. (객체의 모든 필드가 final, 모든 참조 필드는 불변 객체를 직접 참조)
		-	함수나 메서드가 어떤 예외도 일으키지 않아야 한다. (예외가 발생하면 return 으로 객체를 반환할 수 없게 될 수 있음)
		-	함수형에서는 비함수형 동작을 감출 수 있는 상황에서만 부작용를 포함하는 라이브러리 함수를 사용해야 한다. (먼저 자료구조를 복사하든가 발생할 수 있는 예제를 적절하게 내부적으로 처리함으로써 자료구조의 변경을 호출자가 알 수 없도록 감춰야 함)

-	참조 투명성

	-	'부작용을 감춰야 한다'라는 제약은 참조 투명성 개념으로 귀결된다.

		-	같은 인수로 함수를 호출했을 때 항상 같은 결과를 반환한다면 참조적으로 투명한 함수라고 표햔한다.
		-	함수는 어떤 입력이 주어졌을 때 언제 어디서 호출하든 같은 결과를 생성해야 한다.

	-	참조 투명성은 프로그램 이해에 큰 도움을 준다.

	-	참조 투명성은 비싸거나 오랜 시간이 걸리는 연산을 기억화 또는 캐싱을 통해 다시 계산하지 않고 저장하는 최적화 기능도 제공한다.

##### 18.3 재귀와 반복

-	순수 함수형 프로그래밍 언어에서는 while, for 같은 반복문을 포함하지 않는다.

	-	이러한 반복문 때문에 변화가 자연스럽게 코드에 스며들 수 있음 (부작용발생위험)

-	이론적으로 반복을 이용하는 모든 프로그램은 재귀로도 구현할 수 있는데 재귀를 이용하면 변화가 일어나지 않는다.

	-	하지만 일반적으로 반복코드보다 재귀코드가 더 비싸다. (함수를 호출할 때마다 호출 스택에 각 호출 시 생성되는 정보를 저장할 새로운 스택 프레임이 만들어짐. > 메모리 사용량이 증가함)

	-	함수형언어에서는 꼬리 호출 최적화 를 통해 해결한다.

		-	중간 결과를 각각의 스택프레임으로 저장해야 하는 일반 재귀와 달리 꼬리 재귀에서는 컴파일러가 하나의 스택 프레임을 재활용할 가능성이 생긴다.

-	결론

	-	자바8에서는 반복을 스트림으로 대체해서 변화를 피할 수 있다.
	-	반복을 재귀로 바꾸면 더 간결하고, 부작용이 없는 알고리즘을 만들 수 있다.
	-	재귀를 이용하면 좀 더 쉽게 읽고, 쓰고, 이해할 수 있는 예제를 만들 수 있다.
	-	약간의 실행시간 차이보다는 프로그래머의 효율성이 더 중요할 때도 많다.
